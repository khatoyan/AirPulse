
**1. Исходная интенсивность выброса источника (Q₀):**

Расчет выполняется функцией `estimateEmissionRateQ`. Это сложная функция, зависящая от многих факторов:

`Q₀ = f_Q(Species, CrownD, Age, State, RH, Precip, TimeOfDay, Temp)`

Где:
*   `Species`: Вид дерева (влияет на базовую эмиссию `Q_base`).
*   `CrownD`: Диаметр кроны (влияет через `crownFactor`).
*   `Age`: Возрастная группа (влияет через `ageFactor`).
*   `State`: Состояние дерева (влияет через `stateFactor`).
*   `RH`: Относительная влажность (влияет через `humidityFactor`).
*   `Precip`: Интенсивность осадков (если > 0.1, то `Q₀ = 0`).
*   `TimeOfDay`: Время суток ('day' или 'night', влияет через `diurnalFactor`).
*   `Temp`: Температура (может влиять через `tempFactor`, если раскомментировано).

Эта функция комбинирует базовую норму эмиссии с поправочными коэффициентами. `Q₀` имеет размерность [единицы пыльцы / секунду].

**2. Метеорологические параметры:**

*   **Класс стабильности атмосферы (S):** Определяется по Пасквиллу-Гиффорду функцией `getAtmosphericStabilityClass`.
    `S = f_S(u₁₀, TimeOfDay, CloudCover)`
    Где `u₁₀` - скорость ветра на высоте 10м, `CloudCover` - характеристика облачности/солнечной радиации. `S` принимает значения от 'A' (очень нестабильно) до 'F' (очень стабильно).

*   **Показатель степени профиля ветра (p):** Определяется функцией `getWindProfileExponent`.
    `p = f_p(S, R)`
    Где `R` - тип местности ('open', 'suburban', 'urban').

*   **Скорость ветра на высоте источника H (u_H):** Рассчитывается функцией `getWindSpeedAtHeight`.
    `u_H = max(u_min, u₁₀ * (H / H_ref)^p)`
    Где `H_ref = 10` м, `u_min` - минимальная скорость ветра (0.5 м/с).

**3. Геометрия и Координаты:**

*   **Расстояние (d):** Горизонтальное расстояние между источником `T` и рецептором `P`, рассчитанное по формуле Гаверсинуса (`calculateDistance`).
*   **Направление ветра (θ_wind):** Метеорологическое направление, *откуда* дует ветер (в градусах).
*   **Направление распространения плюма (θ_plume):** `θ_plume = (θ_wind + 180) mod 360`.
*   **Азимут от источника к рецептору (θ_TP):** Рассчитывается функцией `calculateBearing`.
*   **Угловое отклонение рецептора от оси плюма (Δθ):** `Δθ = θ_TP - θ_plume` (приведенное к диапазону [-180, 180]).
*   **Расстояние вдоль оси ветра (x):** `x = d * cos(Δθ)` (в радианах). Если `x <= 1`, то `C = 0`.
*   **Расстояние поперек оси ветра (y):** `y = d * sin(Δθ)` (в радианах).

**4. Параметры Дисперсии (σ_y, σ_z):**

Рассчитываются функцией `getDispersionCoefficients`. Формулы зависят от типа местности `R`:

*   **Для 'urban'/'suburban':** Используются степенные зависимости вида `σ = a * x^b`, где коэффициенты `a` и показатели `b` берутся из таблиц (`urban_sy_coeffs`, `urban_sy_exp`, `urban_sz_coeffs`, `urban_sz_exp`), зависящих от класса стабильности `S`. Для `suburban` может применяться небольшой понижающий множитель.
    `σ_y = f_{σy, urban}(x, S)`
    `σ_z = f_{σz, urban}(x, S)`
*   **Для 'open':** Используются другие степенные зависимости (также зависящие от `S`).
    `σ_y = f_{σy, open}(x, S)`
    `σ_z = f_{σz, open}(x, S)`

В обоих случаях `σ_y = max(σ_{min}, σ_y)` и `σ_z = max(σ_{min}, σ_z)`, где `σ_{min}` - минимальное значение сигмы (0.5 м).

**5. Осаждение и Истощение:**

*   **Скорость сухого осаждения (v_d):** Берется из таблицы `DEPOSITION_VELOCITIES` в зависимости от типа местности `R`.
    `v_d = f_{vd}(R)`
*   **Скорость гравитационного оседания пыльцы (v_s):** Берется из таблицы `SETTLING_VELOCITIES` в зависимости от вида дерева `Species`.
    `v_s = f_{vs}(Species)`
*   **Коэффициент истощения источника (F_d):** Рассчитывается по упрощенной формуле в `calculateSourceDepletionFactor`.
    `F_d = max(0.01, min(1, exp(- (C_dep * v_d * x) / (u_H * H))))`
    Где `C_dep` - эмпирический коэффициент (в коде = 0.8).
*   **Интенсивность выброса с учетом истощения (Q_x):**
    `Q_x = Q₀ * F_d`

**6. Эффективная высота источника (H_eff) - Модель Наклоненного Плюма:**

Учитывает снижение высоты оси плюма из-за гравитационного оседания:
`H_eff = max(0, H - (v_s * x) / u_H)`

**7. Формула Концентрации Гауссова Плюма (C):**

Итоговая концентрация `C` на высоте `z` в точке с координатами `(x, y)` относительно источника:

`C(x, y, z) = (Q_x / (2 * π * σ_y * σ_z * u_H)) * exp(-y² / (2 * σ_y²)) * V`

Где `V` - вертикальный член, учитывающий отражение от земли и эффективную высоту источника:

`V = [ exp(-(z - H_eff)² / (2 * σ_z²)) + exp(-(z + H_eff)² / (2 * σ_z²)) ]`

**Важные Замечания:**

*   Эта математическая запись точно отражает логику **твоего JavaScript кода**, включая все его упрощения (особенно в части коэффициентов дисперсии для города и модели истощения).
*   Функции `f_Q`, `f_S`, `f_p`, `f_{σy}`, `f_{σz}`, `f_{vd}`, `f_{vs}` представляют собой табличные значения или условные операторы, реализованные в коде.
*   Модель не учитывает сложный рельеф или отдельные здания (кроме как через усредненные параметры для типа местности `R`).
*   Обработка очень близких расстояний (`d < 5`) в коде является заглушкой и не описывается основной Гауссовой формулой.
*   Точность модели сильно зависит от адекватности входных параметров (`Q_base`, `v_s`, `v_d`, коэффициенты для `σ_y`, `σ_z`) реальным условиям.

